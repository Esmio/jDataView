!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jDataView=e()}(this,function(){"use strict";function t(t,e){return"object"==typeof t&&null!==t&&(t.constructor===e||Object.prototype.toString.call(t)==="[object "+e.name+"]")}function e(e,i){return!i&&t(e,Array)?e:Array.prototype.slice.call(e)}function i(t,e){return void 0!==t?t:e}function n(e,r,s,f){if(n.is(e)){var o=e.slice(r,r+s);return o._littleEndian=i(f,o._littleEndian),o}if(!n.is(this))return new n(e,r,s,f);if(this.buffer=e=n.wrapBuffer(e),this._isArrayBuffer=c.ArrayBuffer&&t(e,ArrayBuffer),this._isPixelData=c.PixelData&&t(e,CanvasPixelArray),this._isDataView=c.DataView&&this._isArrayBuffer,this._isNodeBuffer=!1,!this._isArrayBuffer&&!this._isPixelData&&!t(e,Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!f;var a="byteLength"in e?e.byteLength:e.length;this.byteOffset=r=i(r,0),this.byteLength=s=i(s,a-r),this._offset=this._bitOffset=0,this._isDataView?this._view=new DataView(e,r,s):this._checkBounds(r,s,a),this._engineAction=this._isDataView?this._dataViewAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function r(t){for(var e=new(c.ArrayBuffer?Uint8Array:Array)(t.length),i=0,n=t.length;i<n;i++)e[i]=255&t.charCodeAt(i);return e}function s(t){return t>=0&&t<31?1<<t:s[t]||(s[t]=Math.pow(2,t))}function f(t,e){this.lo=t,this.hi=e}function o(t,e){f.call(this,t,e)}function a(t){for(var e=t.toString().split(""),i=0;i<e.length;i++)e[i]=+e[i];return e.reverse(),e}function h(t,e){for(var i=[],n=Math.max(t.length,e.length),r=0,s=0;s<n||r;){var f=r+(s<t.length?t[s]:0)+(s<e.length?e[s]:0);i.push(f%10),r=Math.floor(f/10),s++}return i}var u=self,c={NodeBuffer:!1,DataView:"DataView"in u,ArrayBuffer:"ArrayBuffer"in u,PixelData:"CanvasPixelArray"in u&&!("Uint8ClampedArray"in u)&&"document"in u},y=u.TextEncoder,_=u.TextDecoder;if(c.PixelData)var l=document.createElement("canvas").getContext("2d"),g=function(t,e){var i=l.createImageData((t+3)/4,1).data;if(i.byteLength=t,void 0!==e)for(var n=0;n<t;n++)i[n]=e[n];return i};var p={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8};n.wrapBuffer=function(i){switch(typeof i){case"number":if(c.ArrayBuffer)i=new Uint8Array(i).buffer;else if(c.PixelData)i=g(i);else{i=new Array(i);for(var n=0;n<i.length;n++)i[n]=0}return i;case"string":i=r(i);default:return"length"in i&&!(c.ArrayBuffer&&t(i,ArrayBuffer)||c.PixelData&&t(i,CanvasPixelArray))&&(c.ArrayBuffer?t(i,ArrayBuffer)||t(i=new Uint8Array(i).buffer,ArrayBuffer)||(i=new Uint8Array(e(i,!0)).buffer):i=c.PixelData?g(i.length,i):e(i)),i}},n.is=function(t){return t&&t.jDataView},n.from=function(){return new n(arguments)},n.Uint64=f,f.prototype.valueOf=function(){return this.lo+s(32)*this.hi},f.fromNumber=function(t){var e=Math.floor(t/s(32));return new f(t-e*s(32),e)},n.Int64=o,(o.prototype="create"in Object?Object.create(f.prototype):new f).valueOf=function(){return this.hi<s(31)?f.prototype.valueOf.apply(this,arguments):-(s(32)-this.lo+s(32)*(s(32)-1-this.hi))},o.fromNumber=function(t){var e,i;if(t>=0){var n=f.fromNumber(t);e=n.lo,i=n.hi}else e=t-(i=Math.floor(t/s(32)))*s(32),i+=s(32);return new o(e,i)},f.prototype.toString=function(){if(this.hi<s(19))return Number.prototype.toString.apply(this.valueOf(),arguments);for(var t=a(this.hi),e=a(this.lo),i=0;i<32;i++)t=h(t,t);var n=h(t,e),r="";for(i=n.length-1;i>=0;i--)r+=n[i];return r},o.prototype.toString=function(){return this.hi<s(31)?f.prototype.toString.apply(this,arguments):this.hi>s(32)-1-s(19)?Number.prototype.toString.apply(this.valueOf(),arguments):"-"+new f(s(32)-this.lo,s(32)-1-this.hi).toString()};var v=n.prototype={compatibility:c,jDataView:!0,_checkBounds:function(t,e,n){if("number"!=typeof t)throw new TypeError("Offset is not a number.");if("number"!=typeof e)throw new TypeError("Size is not a number.");if(e<0)throw new RangeError("Length is negative.");if(t<0||t+e>i(n,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(t,e,n,r,s){return this._engineAction(t,e,i(n,this._offset),i(r,this._littleEndian),s)},_dataViewAction:function(t,e,i,n,r){return this._offset=i+p[t],e?this._view["get"+t](i,n):this._view["set"+t](i,r,n)},_arrayBufferAction:function(t,e,n,r,s){var f,o=p[t],a=u[t+"Array"];if(r=i(r,this._littleEndian),1===o||(this.byteOffset+n)%o==0&&r)return f=new a(this.buffer,this.byteOffset+n,1),this._offset=n+o,e?f[0]:f[0]=s;var h=new Uint8Array(e?this.getBytes(o,n,r,!0):o);if(f=new a(h.buffer,0,1),e)return f[0];f[0]=s,this._setBytes(n,h,r)},_arrayAction:function(t,e,i,n,r){return e?this["_get"+t](i,n):this["_set"+t](i,r,n)},_getBytes:function(t,n,r){r=i(r,this._littleEndian),n=i(n,this._offset),t=i(t,this.byteLength-n),this._checkBounds(n,t),n+=this.byteOffset,this._offset=n-this.byteOffset+t;var s=this._isArrayBuffer?new Uint8Array(this.buffer,n,t):(this.buffer.slice||Array.prototype.slice).call(this.buffer,n,n+t);return r||t<=1?s:e(s).reverse()},getBytes:function(t,n,r,s){var f=this._getBytes(t,n,i(r,!0));return s?e(f):f},_setBytes:function(t,n,r){var s=n.length;if(0!==s){if(r=i(r,this._littleEndian),t=i(t,this._offset),this._checkBounds(t,s),!r&&s>1&&(n=e(n,!0).reverse()),t+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,t,s).set(n);else for(var f=0;f<s;f++)this.buffer[t+f]=n[f];this._offset=t-this.byteOffset+s}},setBytes:function(t,e,n){this._setBytes(t,e,i(n,!0))},getString:function(t,e,i){var n=this._getBytes(t,e,!0);if(i="utf8"===i?"utf-8":i||"binary",_&&"binary"!==i)return new _(i).decode(this._isArrayBuffer?n:new Uint8Array(n));var r="";t=n.length;for(var s=0;s<t;s++)r+=String.fromCharCode(n[s]);return"utf-8"===i&&(r=decodeURIComponent(escape(r))),r},setString:function(t,e,i){i="utf8"===i?"utf-8":i||"binary";var n;y&&"binary"!==i?n=new y(i).encode(e):("utf-8"===i&&(e=unescape(encodeURIComponent(e))),n=r(e)),this._setBytes(t,n,!0)},getChar:function(t){return this.getString(1,t)},setChar:function(t,e){this.setString(t,e)},tell:function(){return this._offset},seek:function(t){return this._checkBounds(t,0),this._offset=t},skip:function(t){return this.seek(this._offset+t)},slice:function(t,e,r){function s(t,e){return t<0?t+e:t}return t=s(t,this.byteLength),e=s(i(e,this.byteLength),this.byteLength),r?new n(this.getBytes(e-t,t,!0,!0),void 0,void 0,this._littleEndian):new n(this.buffer,this.byteOffset+t,e-t,this._littleEndian)},alignBy:function(t){return this._bitOffset=0,1!==i(t,1)?this.skip(t-(this._offset%t||t)):this._offset},_getFloat64:function(t,e){var i=this._getBytes(8,t,e),n=1-2*(i[7]>>7),r=((i[7]<<1&255)<<3|i[6]>>4)-1023,f=(15&i[6])*s(48)+i[5]*s(40)+i[4]*s(32)+i[3]*s(24)+i[2]*s(16)+i[1]*s(8)+i[0];return 1024===r?0!==f?NaN:n*(1/0):-1023===r?n*f*s(-1074):n*(1+f*s(-52))*s(r)},_getFloat32:function(t,e){var i=this._getBytes(4,t,e),n=1-2*(i[3]>>7),r=(i[3]<<1&255|i[2]>>7)-127,f=(127&i[2])<<16|i[1]<<8|i[0];return 128===r?0!==f?NaN:n*(1/0):-127===r?n*f*s(-149):n*(1+f*s(-23))*s(r)},_get64:function(t,e,n){n=i(n,this._littleEndian),e=i(e,this._offset);for(var r=n?[0,4]:[4,0],s=0;s<2;s++)r[s]=this.getUint32(e+r[s],n);return this._offset=e+8,new t(r[0],r[1])},getInt64:function(t,e){return this._get64(o,t,e)},getUint64:function(t,e){return this._get64(f,t,e)},_getInt32:function(t,e){var i=this._getBytes(4,t,e);return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},_getUint32:function(t,e){return this._getInt32(t,e)>>>0},_getInt16:function(t,e){return this._getUint16(t,e)<<16>>16},_getUint16:function(t,e){var i=this._getBytes(2,t,e);return i[1]<<8|i[0]},_getInt8:function(t){return this._getUint8(t)<<24>>24},_getUint8:function(t){return this._getBytes(1,t)[0]},_getBitRangeData:function(t,e){var n=(i(e,this._offset)<<3)+this._bitOffset,r=n+t,s=n>>>3,f=r+7>>>3,o=this._getBytes(f-s,s,!0),a=0;(this._bitOffset=7&r)&&(this._bitOffset-=8);for(var h=0,u=o.length;h<u;h++)a=a<<8|o[h];return{start:s,bytes:o,wideValue:a}},getSigned:function(t,e){var i=32-t;return this.getUnsigned(t,e)<<i>>i},getUnsigned:function(t,e){var i=this._getBitRangeData(t,e).wideValue>>>-this._bitOffset;return t<32?i&~(-1<<t):i},_setBinaryFloat:function(t,e,i,n,r){var f,o,a=e<0?1:0,h=~(-1<<n-1),u=1-h;e<0&&(e=-e),0===e?(f=0,o=0):isNaN(e)?(f=2*h+1,o=1):e===1/0?(f=2*h+1,o=0):(f=Math.floor(Math.log(e)/Math.LN2))>=u&&f<=h?(o=Math.floor((e*s(-f)-1)*s(i)),f+=h):(o=Math.floor(e/s(u-i)),f=0);for(var c=[];i>=8;)c.push(o%256),o=Math.floor(o/256),i-=8;for(f=f<<i|o,n+=i;n>=8;)c.push(255&f),f>>>=8,n-=8;c.push(a<<n|f),this._setBytes(t,c,r)},_setFloat32:function(t,e,i){this._setBinaryFloat(t,e,23,8,i)},_setFloat64:function(t,e,i){this._setBinaryFloat(t,e,52,11,i)},_set64:function(t,e,n,r){"object"!=typeof n&&(n=t.fromNumber(n)),r=i(r,this._littleEndian),e=i(e,this._offset);var s=r?{lo:0,hi:4}:{lo:4,hi:0};for(var f in s)this.setUint32(e+s[f],n[f],r);this._offset=e+8},setInt64:function(t,e,i){this._set64(o,t,e,i)},setUint64:function(t,e,i){this._set64(f,t,e,i)},_setUint32:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255,e>>>16&255,e>>>24],i)},_setUint16:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255],i)},_setUint8:function(t,e){this._setBytes(t,[255&e])},setUnsigned:function(t,e,i){var n=this._getBitRangeData(i,t),r=n.wideValue,s=n.bytes;r&=~(~(-1<<i)<<-this._bitOffset),r|=(i<32?e&~(-1<<i):e)<<-this._bitOffset;for(var f=s.length-1;f>=0;f--)s[f]=255&r,r>>>=8;this._setBytes(n.start,s,!0)}};for(var b in p)!function(t){v["get"+t]=function(e,i){return this._action(t,!0,e,i)},v["set"+t]=function(e,i,n){this._action(t,!1,e,n,i)}}(b);v._setInt32=v._setUint32,v._setInt16=v._setUint16,v._setInt8=v._setUint8,v.setSigned=v.setUnsigned;for(var d in v)"set"===d.slice(0,3)&&function(t){v["write"+t]=function(){Array.prototype.unshift.call(arguments,void 0),this["set"+t].apply(this,arguments)}}(d.slice(3));return n});

//# sourceMappingURL=jdataview.js.map
!function(t){var e=this;"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define([],function(){return t(e)}):e.jDataView=t(e)}(function(t){"use strict";function e(t,e){return"object"==typeof t&&null!==t&&(t.constructor===e||Object.prototype.toString.call(t)==="[object "+e.name+"]")}function i(t,i){return!i&&e(t,Array)?t:Array.prototype.slice.call(t)}function n(t,e){return void 0!==t?t:e}function r(t,i,s,f){if(r.is(t)){var o=t.slice(i,i+s);return o._littleEndian=n(f,o._littleEndian),o}if(!r.is(this))return new r(t,i,s,f);if(this.buffer=t=r.wrapBuffer(t),this._isArrayBuffer=c.ArrayBuffer&&e(t,ArrayBuffer),this._isPixelData=c.PixelData&&e(t,CanvasPixelArray),this._isDataView=c.DataView&&this._isArrayBuffer,this._isNodeBuffer=!1,!this._isArrayBuffer&&!this._isPixelData&&!e(t,Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!f;var a="byteLength"in t?t.byteLength:t.length;this.byteOffset=i=n(i,0),this.byteLength=s=n(s,a-i),this._offset=this._bitOffset=0,this._isDataView?this._view=new DataView(t,i,s):this._checkBounds(i,s,a),this._engineAction=this._isDataView?this._dataViewAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function s(t){for(var e=new(c.ArrayBuffer?Uint8Array:Array)(t.length),i=0,n=t.length;i<n;i++)e[i]=255&t.charCodeAt(i);return e}function f(t){return t>=0&&t<31?1<<t:f[t]||(f[t]=Math.pow(2,t))}function o(t,e){this.lo=t,this.hi=e}function a(t,e){o.apply(this,arguments)}function h(t){for(var e=t.toString().split(""),i=0;i<e.length;i++)e[i]=+e[i];return e.reverse(),e}function u(t,e){for(var i=[],n=Math.max(t.length,e.length),r=0,s=0;s<n||r;){var f=r+(s<t.length?t[s]:0)+(s<e.length?e[s]:0);i.push(f%10),r=Math.floor(f/10),s++}return i}var c={NodeBuffer:!1,DataView:"DataView"in t,ArrayBuffer:"ArrayBuffer"in t,PixelData:"CanvasPixelArray"in t&&!("Uint8ClampedArray"in t)&&"document"in t},y=t.TextEncoder,_=t.TextDecoder;if(c.PixelData)var l=document.createElement("canvas").getContext("2d"),g=function(t,e){var i=l.createImageData((t+3)/4,1).data;if(i.byteLength=t,void 0!==e)for(var n=0;n<t;n++)i[n]=e[n];return i};var p={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8};r.wrapBuffer=function(t){switch(typeof t){case"number":if(c.ArrayBuffer)t=new Uint8Array(t).buffer;else if(c.PixelData)t=g(t);else{t=new Array(t);for(var n=0;n<t.length;n++)t[n]=0}return t;case"string":t=s(t);default:return"length"in t&&!(c.ArrayBuffer&&e(t,ArrayBuffer)||c.PixelData&&e(t,CanvasPixelArray))&&(c.ArrayBuffer?e(t,ArrayBuffer)||e(t=new Uint8Array(t).buffer,ArrayBuffer)||(t=new Uint8Array(i(t,!0)).buffer):t=c.PixelData?g(t.length,t):i(t)),t}},r.is=function(t){return t&&t.jDataView},r.from=function(){return new r(arguments)},r.Uint64=o,o.prototype.valueOf=function(){return this.lo+f(32)*this.hi},o.fromNumber=function(t){var e=Math.floor(t/f(32));return new o(t-e*f(32),e)},r.Int64=a,a.prototype="create"in Object?Object.create(o.prototype):new o,a.prototype.valueOf=function(){return this.hi<f(31)?o.prototype.valueOf.apply(this,arguments):-(f(32)-this.lo+f(32)*(f(32)-1-this.hi))},a.fromNumber=function(t){var e,i;if(t>=0){var n=o.fromNumber(t);e=n.lo,i=n.hi}else e=t-(i=Math.floor(t/f(32)))*f(32),i+=f(32);return new a(e,i)},o.prototype.toString=function(){if(this.hi<f(19))return Number.prototype.toString.apply(this.valueOf(),arguments);for(var t=h(this.hi),e=h(this.lo),i=0;i<32;i++)t=u(t,t);var n=u(t,e),r="";for(i=n.length-1;i>=0;i--)r+=n[i];return r},a.prototype.toString=function(){return this.hi<f(31)?o.prototype.toString.apply(this,arguments):this.hi>f(32)-1-f(19)?Number.prototype.toString.apply(this.valueOf(),arguments):"-"+new o(f(32)-this.lo,f(32)-1-this.hi).toString()};var v=r.prototype={compatibility:c,jDataView:!0,_checkBounds:function(t,e,i){if("number"!=typeof t)throw new TypeError("Offset is not a number.");if("number"!=typeof e)throw new TypeError("Size is not a number.");if(e<0)throw new RangeError("Length is negative.");if(t<0||t+e>n(i,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(t,e,i,r,s){return this._engineAction(t,e,n(i,this._offset),n(r,this._littleEndian),s)},_dataViewAction:function(t,e,i,n,r){return this._offset=i+p[t],e?this._view["get"+t](i,n):this._view["set"+t](i,r,n)},_arrayBufferAction:function(e,i,r,s,f){var o,a=p[e],h=t[e+"Array"];if(s=n(s,this._littleEndian),1===a||(this.byteOffset+r)%a==0&&s)return o=new h(this.buffer,this.byteOffset+r,1),this._offset=r+a,i?o[0]:o[0]=f;var u=new Uint8Array(i?this.getBytes(a,r,s,!0):a);if(o=new h(u.buffer,0,1),i)return o[0];o[0]=f,this._setBytes(r,u,s)},_arrayAction:function(t,e,i,n,r){return e?this["_get"+t](i,n):this["_set"+t](i,r,n)},_getBytes:function(t,e,r){r=n(r,this._littleEndian),e=n(e,this._offset),t=n(t,this.byteLength-e),this._checkBounds(e,t),e+=this.byteOffset,this._offset=e-this.byteOffset+t;var s=this._isArrayBuffer?new Uint8Array(this.buffer,e,t):(this.buffer.slice||Array.prototype.slice).call(this.buffer,e,e+t);return r||t<=1?s:i(s).reverse()},getBytes:function(t,e,r,s){var f=this._getBytes(t,e,n(r,!0));return s?i(f):f},_setBytes:function(t,e,r){var s=e.length;if(0!==s){if(r=n(r,this._littleEndian),t=n(t,this._offset),this._checkBounds(t,s),!r&&s>1&&(e=i(e,!0).reverse()),t+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,t,s).set(e);else for(var f=0;f<s;f++)this.buffer[t+f]=e[f];this._offset=t-this.byteOffset+s}},setBytes:function(t,e,i){this._setBytes(t,e,n(i,!0))},getString:function(t,e,i){var n=this._getBytes(t,e,!0);if(i="utf8"===i?"utf-8":i||"binary",_&&"binary"!==i)return new _(i).decode(this._isArrayBuffer?n:new Uint8Array(n));var r="";t=n.length;for(var s=0;s<t;s++)r+=String.fromCharCode(n[s]);return"utf-8"===i&&(r=decodeURIComponent(escape(r))),r},setString:function(t,e,i){i="utf8"===i?"utf-8":i||"binary";var n;y&&"binary"!==i?n=new y(i).encode(e):("utf-8"===i&&(e=unescape(encodeURIComponent(e))),n=s(e)),this._setBytes(t,n,!0)},getChar:function(t){return this.getString(1,t)},setChar:function(t,e){this.setString(t,e)},tell:function(){return this._offset},seek:function(t){return this._checkBounds(t,0),this._offset=t},skip:function(t){return this.seek(this._offset+t)},slice:function(t,e,i){function s(t,e){return t<0?t+e:t}return t=s(t,this.byteLength),e=s(n(e,this.byteLength),this.byteLength),i?new r(this.getBytes(e-t,t,!0,!0),void 0,void 0,this._littleEndian):new r(this.buffer,this.byteOffset+t,e-t,this._littleEndian)},alignBy:function(t){return this._bitOffset=0,1!==n(t,1)?this.skip(t-(this._offset%t||t)):this._offset},_getFloat64:function(t,e){var i=this._getBytes(8,t,e),n=1-2*(i[7]>>7),r=((i[7]<<1&255)<<3|i[6]>>4)-1023,s=(15&i[6])*f(48)+i[5]*f(40)+i[4]*f(32)+i[3]*f(24)+i[2]*f(16)+i[1]*f(8)+i[0];return 1024===r?0!==s?NaN:n*(1/0):-1023===r?n*s*f(-1074):n*(1+s*f(-52))*f(r)},_getFloat32:function(t,e){var i=this._getBytes(4,t,e),n=1-2*(i[3]>>7),r=(i[3]<<1&255|i[2]>>7)-127,s=(127&i[2])<<16|i[1]<<8|i[0];return 128===r?0!==s?NaN:n*(1/0):-127===r?n*s*f(-149):n*(1+s*f(-23))*f(r)},_get64:function(t,e,i){i=n(i,this._littleEndian),e=n(e,this._offset);for(var r=i?[0,4]:[4,0],s=0;s<2;s++)r[s]=this.getUint32(e+r[s],i);return this._offset=e+8,new t(r[0],r[1])},getInt64:function(t,e){return this._get64(a,t,e)},getUint64:function(t,e){return this._get64(o,t,e)},_getInt32:function(t,e){var i=this._getBytes(4,t,e);return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},_getUint32:function(t,e){return this._getInt32(t,e)>>>0},_getInt16:function(t,e){return this._getUint16(t,e)<<16>>16},_getUint16:function(t,e){var i=this._getBytes(2,t,e);return i[1]<<8|i[0]},_getInt8:function(t){return this._getUint8(t)<<24>>24},_getUint8:function(t){return this._getBytes(1,t)[0]},_getBitRangeData:function(t,e){var i=(n(e,this._offset)<<3)+this._bitOffset,r=i+t,s=i>>>3,f=r+7>>>3,o=this._getBytes(f-s,s,!0),a=0;(this._bitOffset=7&r)&&(this._bitOffset-=8);for(var h=0,u=o.length;h<u;h++)a=a<<8|o[h];return{start:s,bytes:o,wideValue:a}},getSigned:function(t,e){var i=32-t;return this.getUnsigned(t,e)<<i>>i},getUnsigned:function(t,e){var i=this._getBitRangeData(t,e).wideValue>>>-this._bitOffset;return t<32?i&~(-1<<t):i},_setBinaryFloat:function(t,e,i,n,r){var s,o,a=e<0?1:0,h=~(-1<<n-1),u=1-h;e<0&&(e=-e),0===e?(s=0,o=0):isNaN(e)?(s=2*h+1,o=1):e===1/0?(s=2*h+1,o=0):(s=Math.floor(Math.log(e)/Math.LN2))>=u&&s<=h?(o=Math.floor((e*f(-s)-1)*f(i)),s+=h):(o=Math.floor(e/f(u-i)),s=0);for(var c=[];i>=8;)c.push(o%256),o=Math.floor(o/256),i-=8;for(s=s<<i|o,n+=i;n>=8;)c.push(255&s),s>>>=8,n-=8;c.push(a<<n|s),this._setBytes(t,c,r)},_setFloat32:function(t,e,i){this._setBinaryFloat(t,e,23,8,i)},_setFloat64:function(t,e,i){this._setBinaryFloat(t,e,52,11,i)},_set64:function(t,e,i,r){"object"!=typeof i&&(i=t.fromNumber(i)),r=n(r,this._littleEndian),e=n(e,this._offset);var s=r?{lo:0,hi:4}:{lo:4,hi:0};for(var f in s)this.setUint32(e+s[f],i[f],r);this._offset=e+8},setInt64:function(t,e,i){this._set64(a,t,e,i)},setUint64:function(t,e,i){this._set64(o,t,e,i)},_setUint32:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255,e>>>16&255,e>>>24],i)},_setUint16:function(t,e,i){this._setBytes(t,[255&e,e>>>8&255],i)},_setUint8:function(t,e){this._setBytes(t,[255&e])},setUnsigned:function(t,e,i){var n=this._getBitRangeData(i,t),r=n.wideValue,s=n.bytes;r&=~(~(-1<<i)<<-this._bitOffset),r|=(i<32?e&~(-1<<i):e)<<-this._bitOffset;for(var f=s.length-1;f>=0;f--)s[f]=255&r,r>>>=8;this._setBytes(n.start,s,!0)}};for(var b in p)!function(t){v["get"+t]=function(e,i){return this._action(t,!0,e,i)},v["set"+t]=function(e,i,n){this._action(t,!1,e,n,i)}}(b);v._setInt32=v._setUint32,v._setInt16=v._setUint16,v._setInt8=v._setUint8,v.setSigned=v.setUnsigned;for(var B in v)"set"===B.slice(0,3)&&function(t){v["write"+t]=function(){Array.prototype.unshift.call(arguments,void 0),this["set"+t].apply(this,arguments)}}(B.slice(3));return r});
//# sourceMappingURL=jdataview.js.map